(()=>{var e={};e.id=176,e.ids=[176],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},71017:e=>{"use strict";e.exports=require("path")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},55349:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>h,originalPathname:()=>x,pages:()=>d,routeModule:()=>m,tree:()=>o});var r=s(67096),a=s(16132),i=s(37284),l=s.n(i),n=s(32564),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);s.d(t,c);let o=["",{children:["chat",{children:["[matchId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,11489)),"/Users/shreyansh/ItsMightHappenApp/apps/web/app/chat/[matchId]/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,44599)),"/Users/shreyansh/ItsMightHappenApp/apps/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,44293)),"/Users/shreyansh/ItsMightHappenApp/apps/web/app/not-found.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/Users/shreyansh/ItsMightHappenApp/apps/web/app/chat/[matchId]/page.tsx"],x="/chat/[matchId]/page",h={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/chat/[matchId]/page",pathname:"/chat/[matchId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},87576:(e,t,s)=>{Promise.resolve().then(s.bind(s,83267))},83267:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ChatPage});var r=s(30784),a=s(9885),i=s(57114),l=s(66262),n=s(85217),c=s(40090),o=s(79979),d=s(54049),x=s(76505),h=s(88766),m=s(61526),p=s(47723);function ChatInterface({matchId:e,recipientId:t,recipientName:s,recipientAvatar:i}){let{user:u}=(0,l.tN)(),[f,b]=(0,a.useState)([]),[g,y]=(0,a.useState)(""),[w,j]=(0,a.useState)(!0),[v,_]=(0,a.useState)(!1),N=(0,a.useRef)(null),{resetUnreadCount:k}=(0,l.aK)();(0,a.useEffect)(()=>{let loadAndMarkMessages=async()=>{if(e&&u){j(!0);try{let s=await (0,d.Hu)(e);b(s),s.length>0&&(await (0,d.sk)(e,u.id),k(t))}catch(e){console.error("Error loading messages:",e)}finally{j(!1)}}};loadAndMarkMessages()},[e,u,t,k]),(0,a.useEffect)(()=>{if(!e||!u)return;let s=(0,d.Vp)(e,s=>{b(e=>{let t=e.some(e=>e.id===s.id);return t?e:[...e,s]}),s.receiver_id!==u.id||s.is_read||(0,d.sk)(e,u.id).then(()=>{k(t)}).catch(e=>console.error("Error marking new message as read:",e))});return()=>{s&&s()}},[e,u,t,k]),(0,a.useEffect)(()=>{N.current?.scrollIntoView({behavior:"smooth"})},[f]);let handleSendMessage=async s=>{if(s.preventDefault(),g.trim()&&u&&e){_(!0);try{await (0,d.bG)({match_id:e,sender_id:u.id,receiver_id:t,content:g.trim()}),y("")}catch(e){console.error("Error sending message:",e)}finally{_(!1)}}};return(0,r.jsxs)("div",{className:"flex flex-col h-full bg-black/20 backdrop-blur-lg border border-white/10 rounded-xl shadow-2xl overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-white/10 flex items-center space-x-3 shadow-sm",children:[r.jsx("div",{className:"w-11 h-11 rounded-full bg-white/10 flex items-center justify-center overflow-hidden ring-1 ring-white/20",children:r.jsx(p.q,{src:i,alt:s,size:"md",fallback:r.jsx(o.fzv,{className:"text-researchbee-yellow",size:22})})}),r.jsx("div",{children:r.jsx("h3",{className:"font-semibold text-lg text-white",children:s})})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent",children:[w?(0,r.jsxs)(h.E.div,{className:"flex flex-col items-center justify-center h-full",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:[r.jsx(o.dAq,{className:"animate-spin text-researchbee-yellow text-5xl"}),r.jsx("p",{className:"mt-4 text-gray-300 text-lg",children:"Loading messages..."})]}):0===f.length?(0,r.jsxs)(h.E.div,{className:"flex flex-col items-center justify-center h-full text-center px-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[r.jsx(o.jMy,{className:"text-researchbee-yellow text-6xl mb-5 opacity-80"}),r.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"It's quiet in here..."}),r.jsx("p",{className:"text-gray-400 text-md max-w-xs",children:"No messages in this chat yet. Why not break the ice and send the first message?"})]}):r.jsx(m.M,{initial:!1,children:f.map((e,t)=>{let s=u?.id===e.sender_id,a=e.created_at&&!isNaN(new Date(e.created_at).getTime())?(0,x.Z)(new Date(e.created_at),{addSuffix:!0}):"Sending...";return r.jsx(h.E.div,{layout:!0,initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.95,transition:{duration:.2}},transition:{type:"spring",stiffness:260,damping:20,delay:.05*t},className:`flex ${s?"justify-end":"justify-start"}`,children:r.jsx("div",{className:`flex items-end max-w-[80%] sm:max-w-[70%] ${s?"flex-row-reverse":"flex-row"} space-x-2 space-x-reverse`,children:(0,r.jsxs)("div",{className:`rounded-xl px-3.5 py-2.5 shadow-md backdrop-blur-md break-words whitespace-pre-wrap text-sm sm:text-base leading-relaxed ${s?"bg-researchbee-yellow/80 text-black rounded-br-none":"bg-white/10 text-gray-100 rounded-bl-none"}`,children:[e.content,(0,r.jsxs)("div",{className:`text-xs mt-1.5 flex items-center ${s?"text-black/60 justify-end":"text-gray-400/80 justify-start"}`,children:[r.jsx(o.TCC,{size:10,className:"mr-1"}),r.jsx("span",{children:a})]})]})})},e.id)})}),r.jsx("div",{ref:N})]}),r.jsx("div",{className:"p-3 sm:p-4 border-t border-white/10 bg-black/10 backdrop-blur-sm",children:(0,r.jsxs)("form",{onSubmit:handleSendMessage,className:"flex items-center space-x-2 sm:space-x-3",children:[r.jsx(c.I,{placeholder:"Type a message...",value:g,onChange:e=>y(e.target.value),className:"flex-1 bg-white/5 border-white/20 placeholder-gray-400/60 text-white !py-2.5 sm:!py-3",disabled:v,autoComplete:"off"}),r.jsx(n.z,{type:"submit",disabled:!g.trim()||v,isLoading:v,className:"bg-researchbee-yellow hover:bg-researchbee-darkyellow text-black rounded-lg !p-0 w-11 h-11 sm:w-12 sm:h-12 flex items-center justify-center flex-shrink-0 shadow-md","aria-label":"Send message",children:!v&&r.jsx(o.LbG,{size:18})})]})})]})}var u=s(81067),f=s(6568);function ChatPage(){let e=(0,i.useRouter)(),t=(0,i.useParams)(),s=t?.matchId,{user:c,isLoading:x}=(0,l.tN)(),[h,m]=(0,a.useState)(null),[p,b]=(0,a.useState)(!0),[g,y]=(0,a.useState)(null);return((0,a.useEffect)(()=>{if(x||!c||!s)return;let fetchRecipientProfile=async()=>{b(!0),y(null);try{let e=(0,f.Wq)(),{data:t,error:r}=await e.from("matches").select("user_id_1, user_id_2").eq("id",s).single();if(r||!t)throw Error(r?.message||"Match not found.");let a=t.user_id_1===c.id?t.user_id_2:t.user_id_1;if(!a)throw Error("Could not determine recipient ID from match.");let i=await (0,d.Ai)(a);if(i)m(i);else throw Error("Recipient profile not found.")}catch(e){console.error("Error fetching recipient profile:",e),y(e.message||"Failed to load chat partner details.")}b(!1)};fetchRecipientProfile()},[s,c,x]),x||p)?r.jsx(u._,{title:"Loading Chat...",className:"flex items-center justify-center min-h-screen",children:r.jsx(o.dAq,{className:"animate-spin text-researchbee-yellow text-5xl"})}):g?r.jsx(u._,{title:"Error",className:"flex flex-col items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"glass-card p-8 rounded-xl shadow-lg text-center max-w-md",children:[r.jsx(o.bcx,{className:"mx-auto text-red-400 text-5xl mb-4"}),r.jsx("h2",{className:"text-2xl font-semibold text-white mb-2",children:"Error Loading Chat"}),r.jsx("p",{className:"text-gray-300 mb-6",children:g}),(0,r.jsxs)(n.z,{variant:"outline",onClick:()=>e.back(),className:"border-researchbee-yellow text-researchbee-yellow hover:bg-researchbee-yellow/10",children:[r.jsx(o.Ao2,{className:"mr-2"})," Go Back"]})]})}):c&&h?r.jsx(u._,{title:`Chat with ${h.first_name||"User"}`,className:"h-screen flex flex-col",children:r.jsx(ChatInterface,{matchId:s,recipientId:h.id,recipientName:`${h.first_name||""} ${h.last_name||""}`.trim()||"Chat Partner",recipientAvatar:h.avatar_url||null})}):r.jsx(u._,{title:"Chat Unavailable",className:"flex flex-col items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"glass-card p-8 rounded-xl shadow-lg text-center max-w-md",children:[r.jsx(o.bcx,{className:"mx-auto text-gray-500 text-5xl mb-4"}),r.jsx("h2",{className:"text-2xl font-semibold text-white",children:"Chat Not Available"}),r.jsx("p",{className:"text-gray-300 mb-6",children:"Could not load chat details. Please try again or ensure you are logged in."}),r.jsx(n.z,{variant:"primary",onClick:()=>e.push("/discover"),className:"bg-researchbee-yellow hover:bg-researchbee-darkyellow text-black",children:"Back to Discover"})]})})}},81067:(e,t,s)=>{"use strict";s.d(t,{_:()=>PageContainer});var r=s(30784);s(9885);var a=s(71298),i=s.n(a);function PageContainer({title:e,children:t,className:s}){return(0,r.jsxs)(r.Fragment,{children:[r.jsx(i(),{children:r.jsx("title",{children:`${e} | ResearchCollab`})}),r.jsx("main",{className:`container mx-auto px-4 py-8 ${s||""}`,children:t})]})}},11489:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>i,default:()=>c});var r=s(95153);let a=(0,r.createProxy)(String.raw`/Users/shreyansh/ItsMightHappenApp/apps/web/app/chat/[matchId]/page.tsx`),{__esModule:i,$$typeof:l}=a,n=a.default,c=n}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[998,450,979,781,451,681,842,505,217,677,90,723],()=>__webpack_exec__(55349));module.exports=s})();