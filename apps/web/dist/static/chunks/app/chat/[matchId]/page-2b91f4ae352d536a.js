(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[176],{4411:function(e,t,r){Promise.resolve().then(r.bind(r,9709))},9709:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return ChatPage}});var s=r(7437),a=r(2265),i=r(4033),n=r(4962),l=r(2247),c=r(4977),o=r(231),d=r(501),h=r(7294),x=r(1050),u=r(3760),m=r(1767);function ChatInterface(e){let{matchId:t,recipientId:r,recipientName:i,recipientAvatar:f}=e,{user:b}=(0,n.tN)(),[p,g]=(0,a.useState)([]),[w,y]=(0,a.useState)(""),[v,j]=(0,a.useState)(!0),[N,k]=(0,a.useState)(!1),C=(0,a.useRef)(null),{resetUnreadCount:_}=(0,n.aK)();(0,a.useEffect)(()=>{let loadAndMarkMessages=async()=>{if(t&&b){j(!0);try{let e=await (0,d.Hu)(t);g(e),e.length>0&&(await (0,d.sk)(t,b.id),_(r))}catch(e){console.error("Error loading messages:",e)}finally{j(!1)}}};loadAndMarkMessages()},[t,b,r,_]),(0,a.useEffect)(()=>{if(!t||!b)return;let e=(0,d.Vp)(t,e=>{g(t=>{let r=t.some(t=>t.id===e.id);return r?t:[...t,e]}),e.receiver_id!==b.id||e.is_read||(0,d.sk)(t,b.id).then(()=>{_(r)}).catch(e=>console.error("Error marking new message as read:",e))});return()=>{e&&e()}},[t,b,r,_]),(0,a.useEffect)(()=>{var e;null===(e=C.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[p]);let handleSendMessage=async e=>{if(e.preventDefault(),w.trim()&&b&&t){k(!0);try{await (0,d.bG)({match_id:t,sender_id:b.id,receiver_id:r,content:w.trim()}),y("")}catch(e){console.error("Error sending message:",e)}finally{k(!1)}}};return(0,s.jsxs)("div",{className:"flex flex-col h-full bg-black/20 backdrop-blur-lg border border-white/10 rounded-xl shadow-2xl overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-white/10 flex items-center space-x-3 shadow-sm",children:[(0,s.jsx)("div",{className:"w-11 h-11 rounded-full bg-white/10 flex items-center justify-center overflow-hidden ring-1 ring-white/20",children:(0,s.jsx)(m.q,{src:f,alt:i,size:"md",fallback:(0,s.jsx)(o.fzv,{className:"text-researchbee-yellow",size:22})})}),(0,s.jsx)("div",{children:(0,s.jsx)("h3",{className:"font-semibold text-lg text-white",children:i})})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent",children:[v?(0,s.jsxs)(x.E.div,{className:"flex flex-col items-center justify-center h-full",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:[(0,s.jsx)(o.dAq,{className:"animate-spin text-researchbee-yellow text-5xl"}),(0,s.jsx)("p",{className:"mt-4 text-gray-300 text-lg",children:"Loading messages..."})]}):0===p.length?(0,s.jsxs)(x.E.div,{className:"flex flex-col items-center justify-center h-full text-center px-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[(0,s.jsx)(o.jMy,{className:"text-researchbee-yellow text-6xl mb-5 opacity-80"}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"It's quiet in here..."}),(0,s.jsx)("p",{className:"text-gray-400 text-md max-w-xs",children:"No messages in this chat yet. Why not break the ice and send the first message?"})]}):(0,s.jsx)(u.M,{initial:!1,children:p.map((e,t)=>{let r=(null==b?void 0:b.id)===e.sender_id,a=e.created_at&&!isNaN(new Date(e.created_at).getTime())?(0,h.Z)(new Date(e.created_at),{addSuffix:!0}):"Sending...";return(0,s.jsx)(x.E.div,{layout:!0,initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.95,transition:{duration:.2}},transition:{type:"spring",stiffness:260,damping:20,delay:.05*t},className:"flex ".concat(r?"justify-end":"justify-start"),children:(0,s.jsx)("div",{className:"flex items-end max-w-[80%] sm:max-w-[70%] ".concat(r?"flex-row-reverse":"flex-row"," space-x-2 space-x-reverse"),children:(0,s.jsxs)("div",{className:"rounded-xl px-3.5 py-2.5 shadow-md backdrop-blur-md break-words whitespace-pre-wrap text-sm sm:text-base leading-relaxed ".concat(r?"bg-researchbee-yellow/80 text-black rounded-br-none":"bg-white/10 text-gray-100 rounded-bl-none"),children:[e.content,(0,s.jsxs)("div",{className:"text-xs mt-1.5 flex items-center ".concat(r?"text-black/60 justify-end":"text-gray-400/80 justify-start"),children:[(0,s.jsx)(o.TCC,{size:10,className:"mr-1"}),(0,s.jsx)("span",{children:a})]})]})})},e.id)})}),(0,s.jsx)("div",{ref:C})]}),(0,s.jsx)("div",{className:"p-3 sm:p-4 border-t border-white/10 bg-black/10 backdrop-blur-sm",children:(0,s.jsxs)("form",{onSubmit:handleSendMessage,className:"flex items-center space-x-2 sm:space-x-3",children:[(0,s.jsx)(c.I,{placeholder:"Type a message...",value:w,onChange:e=>y(e.target.value),className:"flex-1 bg-white/5 border-white/20 placeholder-gray-400/60 text-white !py-2.5 sm:!py-3",disabled:N,autoComplete:"off"}),(0,s.jsx)(l.z,{type:"submit",disabled:!w.trim()||N,isLoading:N,className:"bg-researchbee-yellow hover:bg-researchbee-darkyellow text-black rounded-lg !p-0 w-11 h-11 sm:w-12 sm:h-12 flex items-center justify-center flex-shrink-0 shadow-md","aria-label":"Send message",children:!N&&(0,s.jsx)(o.LbG,{size:18})})]})})]})}var f=r(1407),b=r(2445);function ChatPage(){let e=(0,i.useRouter)(),t=(0,i.useParams)(),r=null==t?void 0:t.matchId,{user:c,isLoading:h}=(0,n.tN)(),[x,u]=(0,a.useState)(null),[m,p]=(0,a.useState)(!0),[g,w]=(0,a.useState)(null);return((0,a.useEffect)(()=>{if(h||!c||!r)return;let fetchRecipientProfile=async()=>{p(!0),w(null);try{let e=(0,b.Wq)(),{data:t,error:s}=await e.from("matches").select("user_id_1, user_id_2").eq("id",r).single();if(s||!t)throw Error((null==s?void 0:s.message)||"Match not found.");let a=t.user_id_1===c.id?t.user_id_2:t.user_id_1;if(!a)throw Error("Could not determine recipient ID from match.");let i=await (0,d.Ai)(a);if(i)u(i);else throw Error("Recipient profile not found.")}catch(e){console.error("Error fetching recipient profile:",e),w(e.message||"Failed to load chat partner details.")}p(!1)};fetchRecipientProfile()},[r,c,h]),h||m)?(0,s.jsx)(f._,{title:"Loading Chat...",className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)(o.dAq,{className:"animate-spin text-researchbee-yellow text-5xl"})}):g?(0,s.jsx)(f._,{title:"Error",className:"flex flex-col items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"glass-card p-8 rounded-xl shadow-lg text-center max-w-md",children:[(0,s.jsx)(o.bcx,{className:"mx-auto text-red-400 text-5xl mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-semibold text-white mb-2",children:"Error Loading Chat"}),(0,s.jsx)("p",{className:"text-gray-300 mb-6",children:g}),(0,s.jsxs)(l.z,{variant:"outline",onClick:()=>e.back(),className:"border-researchbee-yellow text-researchbee-yellow hover:bg-researchbee-yellow/10",children:[(0,s.jsx)(o.Ao2,{className:"mr-2"})," Go Back"]})]})}):c&&x?(0,s.jsx)(f._,{title:"Chat with ".concat(x.first_name||"User"),className:"h-screen flex flex-col",children:(0,s.jsx)(ChatInterface,{matchId:r,recipientId:x.id,recipientName:"".concat(x.first_name||""," ").concat(x.last_name||"").trim()||"Chat Partner",recipientAvatar:x.avatar_url||null})}):(0,s.jsx)(f._,{title:"Chat Unavailable",className:"flex flex-col items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"glass-card p-8 rounded-xl shadow-lg text-center max-w-md",children:[(0,s.jsx)(o.bcx,{className:"mx-auto text-gray-500 text-5xl mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-semibold text-white",children:"Chat Not Available"}),(0,s.jsx)("p",{className:"text-gray-300 mb-6",children:"Could not load chat details. Please try again or ensure you are logged in."}),(0,s.jsx)(l.z,{variant:"primary",onClick:()=>e.push("/discover"),className:"bg-researchbee-yellow hover:bg-researchbee-darkyellow text-black",children:"Back to Discover"})]})})}},1407:function(e,t,r){"use strict";r.d(t,{_:function(){return PageContainer}});var s=r(7437);r(2265);var a=r(3574),i=r.n(a);function PageContainer(e){let{title:t,children:r,className:a}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i(),{children:(0,s.jsx)("title",{children:"".concat(t," | ResearchCollab")})}),(0,s.jsx)("main",{className:"container mx-auto px-4 py-8 ".concat(a||""),children:r})]})}},1767:function(e,t,r){"use strict";r.d(t,{q:function(){return Avatar}});var s=r(7437);r(2265);var a=r(6691),i=r.n(a),n=r(1628);function Avatar(e){let{src:t,alt:r,size:a="md",fallback:l,className:c,priority:o=!1}=e,{dimension:d,textClass:h}={sm:{dimension:32,textClass:"text-sm"},md:{dimension:40,textClass:"text-base"},lg:{dimension:64,textClass:"text-xl"},xl:{dimension:128,textClass:"text-3xl"}}[a];return t?(0,s.jsx)("div",{className:(0,n.cn)("relative rounded-full overflow-hidden","w-".concat(d/4," h-").concat(d/4),"min-w-[".concat(d,"px] min-h-[").concat(d,"px] w-[").concat(d,"px] h-[").concat(d,"px]"),c),style:{width:d,height:d},children:(0,s.jsx)(i(),{src:t,alt:r,width:d,height:d,className:"object-cover",priority:o})}):(0,s.jsx)("div",{className:(0,n.cn)("flex items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700","w-".concat(d/4," h-").concat(d/4),"min-w-[".concat(d,"px] min-h-[").concat(d,"px] w-[").concat(d,"px] h-[").concat(d,"px]"),c),style:{width:d,height:d},children:(0,s.jsx)("span",{className:(0,n.cn)("font-semibold text-gray-500 dark:text-gray-400",h),children:l||r.charAt(0).toUpperCase()})})}},2247:function(e,t,r){"use strict";r.d(t,{z:function(){return l}});var s=r(7437),a=r(2265),i=r(9654),n=r(794);let l=a.forwardRef((e,t)=>{let{children:r,className:a,variant:l="primary",size:c="md",isLoading:o=!1,isFullWidth:d=!1,leftIcon:h,rightIcon:x,disabled:u,...m}=e;return(0,s.jsxs)("button",{ref:t,className:(0,i.m6)((0,n.W)("inline-flex items-center justify-center rounded-lg font-semibold tracking-wide transition-all duration-300 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-transparent disabled:opacity-60 disabled:pointer-events-none",{primary:"bg-gradient-to-r from-purple-600 to-pink-500 text-white hover:from-purple-700 hover:to-pink-600 shadow-lg hover:shadow-xl focus-visible:ring-purple-500",secondary:"bg-gray-700/50 text-gray-100 hover:bg-gray-600/70 backdrop-blur-sm border border-gray-600/80 focus-visible:ring-gray-400",accent:"bg-gradient-to-r from-researchbee-yellow to-orange-500 text-black hover:from-researchbee-yellow-dark hover:to-orange-600 shadow-md hover:shadow-lg focus-visible:ring-researchbee-yellow",outline:"border border-white/30 bg-white/5 text-gray-100 backdrop-blur-sm hover:bg-white/10 hover:border-white/50 hover:text-white focus-visible:ring-white/70",ghost:"bg-transparent text-gray-200 hover:bg-white/10 hover:text-white focus-visible:ring-gray-400",danger:"bg-red-500/70 border border-red-500/90 text-white backdrop-blur-sm hover:bg-red-600/80 hover:border-red-600 focus-visible:ring-red-400",glass:"bg-white/10 backdrop-blur-md border border-white/20 text-white hover:bg-white/20 hover:border-white/30 shadow-lg focus-visible:ring-white/50"}[l],{sm:"px-3.5 py-2 text-xs h-9",md:"px-5 py-2.5 text-sm h-10",lg:"px-6 py-3 text-base h-12"}[c],d?"w-full":"",o?"opacity-75 cursor-not-allowed":"",a)),disabled:u||o,...m,children:[o&&(0,s.jsxs)("svg",{className:"animate-spin -ml-0.5 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),!o&&h&&(0,s.jsx)("span",{className:r?"mr-2":"",children:h}),r,!o&&x&&(0,s.jsx)("span",{className:r?"ml-2":"",children:x})]})});l.displayName="Button"},4977:function(e,t,r){"use strict";r.d(t,{I:function(){return n}});var s=r(7437),a=r(2265),i=r(1628);let n=(0,a.forwardRef)((e,t)=>{let{className:r,type:a,...n}=e,l=(0,i.cn)("flex w-full rounded-lg border bg-white/5 backdrop-blur-sm px-4 py-2.5 text-sm text-gray-100 ","placeholder:text-gray-400 caret-purple-400 ","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-500 focus-visible:border-transparent ","disabled:cursor-not-allowed disabled:opacity-50 ","transition-all duration-200 ease-in-out ",e.error?"border-red-500/70 focus-visible:ring-red-500":"border-white/20 hover:border-white/40",r);return"textarea"===a?(0,s.jsx)("textarea",{className:(0,i.cn)(l,"h-auto min-h-[100px]"),ref:t,...n}):(0,s.jsx)("input",{type:a||"text",className:(0,i.cn)(l,"h-11"),ref:t,...n})});n.displayName="Input"},2445:function(e,t,r){"use strict";r.d(t,{Wq:function(){return getBrowserClient}});var s=r(4683);let SupabaseError=class SupabaseError extends Error{constructor(e,t=400,r){super(e),this.name="SupabaseError",this.status=t,this.code=r}};let a="https://yltnvmypasnfdgtnyhwg.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlsdG52bXlwYXNuZmRndG55aHdnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQzNDcxNTMsImV4cCI6MjA1OTkyMzE1M30.ajCPb95af8_It1m_D4yGJhErKuLEtqqfqk8Yq2n4MCw";a&&i||console.error("Missing Supabase environment variables");let n=null;function getBrowserClient(){return n||(n=function(){if(!a||!i)throw new SupabaseError("Missing Supabase environment variables",500);return(0,s.eI)(a,i,{auth:{persistSession:!0,autoRefreshToken:!0}})}())}},1628:function(e,t,r){"use strict";r.d(t,{cn:function(){return cn}});var s=r(794),a=r(9654);function cn(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}}},function(e){e.O(0,[238,683,74,588,691,501,826,169,971,472,744],function(){return e(e.s=4411)}),_N_E=e.O()}]);