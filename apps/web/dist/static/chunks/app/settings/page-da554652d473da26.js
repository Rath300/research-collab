(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{5892:function(e,t,a){Promise.resolve().then(a.bind(a,703))},703:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return SettingsPage}});var r=a(7437),s=a(2265),i=a(4033),n=a(2247),l=a(9812),o=a(1844),d=a(8980),u=a(4962),c=a(8092);function SettingsPage(){let e=(0,i.useRouter)(),{user:t,profile:a,setProfile:m}=(0,u.tN)(),[g,p]=(0,s.useState)({first_name:"",last_name:"",bio:"",institution:"",location:"",field_of_study:"",website:"",availability:"full-time"}),[f,h]=(0,s.useState)(null),[b,x]=(0,s.useState)(null),[v,w]=(0,s.useState)(!1),[y,z]=(0,s.useState)(!1),[j,_]=(0,s.useState)(""),[C,N]=(0,s.useState)("");(0,s.useEffect)(()=>{let loadProfile=async()=>{if(!t){e.push("/login");return}try{if(w(!0),!a){let e=await (0,c.Ai)(t.id);m(e)}a&&(p({first_name:a.first_name||"",last_name:a.last_name||"",bio:a.bio||"",institution:a.institution||"",location:a.location||"",field_of_study:a.field_of_study||"",website:a.website||"",availability:a.availability||"full-time"}),a.avatar_url&&x(a.avatar_url))}catch(e){console.error("Error loading profile:",e),_(e.message||"Failed to load profile data")}finally{w(!1)}};loadProfile()},[t,a,m,e]);let handleInputChange=e=>{let{name:t,value:a}=e.target;p(e=>({...e,[t]:a}))},handleSubmit=async e=>{if(e.preventDefault(),t)try{z(!0),_(""),N("");let e=null==a?void 0:a.avatar_url;if(f){let a=await (0,c.gg)(t.id,f);a&&"string"==typeof a.url?e=a.url:_("Failed to upload new avatar or get its URL. Please try again.")}let r=await (0,c.ck)(t.id,{...g,avatar_url:e});m(r),N("Profile updated successfully")}catch(e){console.error("Error updating profile:",e),_(e.message||"Failed to update profile")}finally{z(!1)}};return v?(0,r.jsx)("div",{className:"container mx-auto max-w-4xl px-4 py-8",children:(0,r.jsx)("div",{className:"flex justify-center py-12",children:(0,r.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-t-2 border-primary-600"})})}):(0,r.jsxs)("div",{className:"container mx-auto max-w-4xl px-4 py-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Account Settings"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsx)("div",{className:"md:col-span-1",children:(0,r.jsx)(o.Zb,{children:(0,r.jsx)(o.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("div",{className:"h-24 w-24 rounded-full bg-primary-100 flex items-center justify-center overflow-hidden mb-4 relative",children:b?(0,r.jsx)("img",{src:b,alt:"Profile",className:"h-full w-full object-cover"}):(0,r.jsx)(d.fzv,{className:"text-primary-600",size:36})}),(0,r.jsxs)("p",{className:"font-medium text-lg",children:[null==a?void 0:a.first_name," ",null==a?void 0:a.last_name]}),(0,r.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:null==t?void 0:t.email}),(0,r.jsx)("div",{className:"mt-4 w-full",children:(0,r.jsxs)("label",{className:"block w-full",children:[(0,r.jsx)("span",{className:"sr-only",children:"Choose profile photo"}),(0,r.jsx)("input",{type:"file",className:"hidden",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;let r=new FileReader;r.onloadend=()=>{x(r.result)},r.readAsDataURL(a),h(a)}}),(0,r.jsxs)(n.z,{type:"button",variant:"outline",className:"w-full",onClick:()=>{let e=document.querySelector('input[type="file"]');null==e||e.click()},children:[(0,r.jsx)(d.Yjd,{className:"mr-2",size:16}),"Change Photo"]})]})})]})})})}),(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsxs)(o.Zb,{children:[(0,r.jsxs)(o.Ol,{children:[(0,r.jsx)(o.ll,{children:"Profile Information"}),(0,r.jsx)(o.SZ,{children:"Update your personal information and public profile"})]}),(0,r.jsx)(o.aY,{children:(0,r.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[j&&(0,r.jsxs)("div",{className:"bg-red-50 text-red-600 p-3 rounded-md flex items-center space-x-2 text-sm dark:bg-red-900/20 dark:text-red-400",children:[(0,r.jsx)(d.bcx,{className:"h-5 w-5 flex-shrink-0"}),(0,r.jsx)("span",{children:j})]}),C&&(0,r.jsx)("div",{className:"bg-green-50 text-green-600 p-3 rounded-md text-sm dark:bg-green-900/20 dark:text-green-400",children:C}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(l.I,{label:"First Name",name:"first_name",value:g.first_name,onChange:handleInputChange,required:!0}),(0,r.jsx)(l.I,{label:"Last Name",name:"last_name",value:g.last_name,onChange:handleInputChange,required:!0})]}),(0,r.jsx)(l.I,{label:"Bio",name:"bio",value:g.bio||"",onChange:handleInputChange,type:"textarea",rows:4,placeholder:"Write a short bio about yourself..."}),(0,r.jsx)(l.I,{label:"Institution",name:"institution",value:g.institution||"",onChange:handleInputChange,placeholder:"e.g., Stanford University"}),(0,r.jsx)(l.I,{label:"Location",name:"location",value:g.location||"",onChange:handleInputChange,placeholder:"e.g., San Francisco, CA"}),(0,r.jsx)(l.I,{label:"Field of Study",name:"field_of_study",value:g.field_of_study||"",onChange:handleInputChange,placeholder:"e.g., Computer Science"}),(0,r.jsx)(l.I,{label:"Website",name:"website",value:g.website||"",onChange:handleInputChange,placeholder:"e.g., https://yourwebsite.com"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Availability"}),(0,r.jsxs)("select",{name:"availability",value:g.availability||"full-time",onChange:handleInputChange,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white",children:[(0,r.jsx)("option",{value:"full-time",children:"Full Time"}),(0,r.jsx)("option",{value:"part-time",children:"Part Time"}),(0,r.jsx)("option",{value:"weekends",children:"Weekends Only"}),(0,r.jsx)("option",{value:"not-available",children:"Not Available"})]})]}),(0,r.jsx)("div",{className:"pt-4",children:(0,r.jsxs)(n.z,{type:"submit",isLoading:y,children:[(0,r.jsx)(d.mW3,{className:"mr-2",size:16}),"Save Changes"]})})]})})]})})]})]})}},2247:function(e,t,a){"use strict";a.d(t,{z:function(){return l}});var r=a(7437),s=a(2265),i=a(9654),n=a(794);let l=s.forwardRef((e,t)=>{let{children:a,className:s,variant:l="primary",size:o="md",isLoading:d=!1,isFullWidth:u=!1,leftIcon:c,rightIcon:m,disabled:g,...p}=e;return(0,r.jsxs)("button",{ref:t,className:(0,i.m6)((0,n.W)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",{primary:"bg-researchbee-yellow text-black hover:bg-researchbee-yellow-dark focus-visible:ring-researchbee-yellow",secondary:"bg-purple-600 text-white hover:bg-purple-700 focus-visible:ring-purple-500",accent:"bg-pink-600 text-white hover:bg-pink-700 focus-visible:ring-pink-500",outline:"border border-gray-300 bg-transparent text-gray-300 hover:bg-gray-700/70 hover:text-white focus-visible:ring-gray-400",ghost:"bg-transparent hover:bg-gray-700/70 text-gray-300 hover:text-white",danger:"border border-red-500 bg-transparent text-red-500 hover:bg-red-500/20 hover:text-red-400 focus-visible:ring-red-400"}[l],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-base"}[o],u?"w-full":"",s)),disabled:g||d,...p,children:[d&&(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),!d&&c&&(0,r.jsx)("span",{className:"mr-2",children:c}),a,!d&&m&&(0,r.jsx)("span",{className:"ml-2",children:m})]})});l.displayName="Button"},1844:function(e,t,a){"use strict";a.d(t,{Ol:function(){return CardHeader},SZ:function(){return CardDescription},Zb:function(){return Card},aY:function(){return CardContent},eW:function(){return CardFooter},ll:function(){return CardTitle}});var r=a(7437);a(2265);var s=a(9654);let Card=e=>{let{children:t,className:a,hover:i=!1}=e;return(0,r.jsx)("div",{className:(0,s.m6)("rounded-lg bg-white p-6 shadow-card transition-shadow dark:bg-slate-800",i&&"hover:shadow-card-hover",a),children:t})},CardHeader=e=>{let{children:t,className:a}=e;return(0,r.jsx)("div",{className:(0,s.m6)("mb-4",a),children:t})},CardTitle=e=>{let{children:t,className:a}=e;return(0,r.jsx)("h3",{className:(0,s.m6)("text-xl font-bold tracking-tight",a),children:t})},CardDescription=e=>{let{children:t,className:a}=e;return(0,r.jsx)("p",{className:(0,s.m6)("text-sm text-gray-500 dark:text-gray-400",a),children:t})},CardContent=e=>{let{children:t,className:a}=e;return(0,r.jsx)("div",{className:(0,s.m6)("",a),children:t})},CardFooter=e=>{let{children:t,className:a}=e;return(0,r.jsx)("div",{className:(0,s.m6)("mt-4 flex items-center",a),children:t})}},9812:function(e,t,a){"use strict";a.d(t,{I:function(){return l}});var r=a(7437),s=a(2265),i=a(794),n=a(9654);function cn(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.m6)((0,i.W)(t))}let l=(0,s.forwardRef)((e,t)=>{let{className:a,type:s,...i}=e,n=cn("flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a);return"textarea"===s?(0,r.jsx)("textarea",{className:cn(n,"h-auto min-h-[80px]"),ref:t,...i}):(0,r.jsx)("input",{type:s,className:cn(n,"h-10"),ref:t,...i})});l.displayName="Input"},8092:function(e,t,a){"use strict";a.d(t,{Ai:function(){return getProfile},ck:function(){return updateProfile},gg:function(){return uploadAvatar}});var r=a(8449),s=a(4683);let i=r.z.object({id:r.z.string().uuid(),first_name:r.z.string().min(1,"First name is required"),last_name:r.z.string().min(1,"Last name is required"),avatar_url:r.z.string().url().nullable(),bio:r.z.string().max(500,"Bio must be less than 500 characters").nullable(),title:r.z.string().nullable(),institution:r.z.string().nullable(),location:r.z.string().nullable(),email:r.z.string().email("Invalid email address").nullable(),website:r.z.string().url("Invalid URL").nullable(),availability:r.z.enum(["full-time","part-time","weekends","not-available"]).nullable(),field_of_study:r.z.string().nullable(),interests:r.z.array(r.z.string()).nullable(),education:r.z.array(r.z.object({degree:r.z.string(),institution:r.z.string(),year:r.z.string()})).nullable(),joining_date:r.z.string().datetime(),created_at:r.z.string().datetime(),updated_at:r.z.string().datetime()});r.z.object({id:r.z.string().uuid(),title:r.z.string().min(3,"Title must be at least 3 characters"),content:r.z.string().min(10,"Content must be at least 10 characters"),user_id:r.z.string().uuid(),tags:r.z.array(r.z.string()).nullable(),visibility:r.z.enum(["public","private","connections"]),is_boosted:r.z.boolean(),engagement_count:r.z.number().int(),created_at:r.z.string().datetime(),updated_at:r.z.string().datetime()}),r.z.object({id:r.z.string().uuid(),user_id_1:r.z.string().uuid(),user_id_2:r.z.string().uuid(),status:r.z.enum(["pending","matched","rejected"]),created_at:r.z.string().datetime(),updated_at:r.z.string().datetime()}),r.z.object({id:r.z.string().uuid(),match_id:r.z.string().uuid(),sender_id:r.z.string().uuid(),receiver_id:r.z.string().uuid(),content:r.z.string().min(1,"Message cannot be empty"),is_read:r.z.boolean(),created_at:r.z.string().datetime()}),r.z.object({email:r.z.string().email("Invalid email address"),password:r.z.string().min(8,"Password must be at least 8 characters"),confirmPassword:r.z.string(),firstName:r.z.string().min(1,"First name is required"),lastName:r.z.string().min(1,"Last name is required"),agreeToTerms:r.z.boolean().refine(e=>!0===e,"You must agree to the terms and conditions")}).refine(e=>e.password===e.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]}),r.z.object({email:r.z.string().email("Invalid email address"),password:r.z.string().min(1,"Password is required")}),r.z.object({title:r.z.string().min(3,"Title must be at least 3 characters"),content:r.z.string().min(10,"Content must be at least 10 characters"),tags:r.z.array(r.z.string()).optional(),visibility:r.z.enum(["public","private","connections"]).default("public")}),i.partial().omit({id:!0,created_at:!0,updated_at:!0,joining_date:!0}),r.z.object({id:r.z.string(),user_id:r.z.string(),type:r.z.enum(["message","match","system","mention"]),title:r.z.string(),body:r.z.string(),link:r.z.string().url().nullable(),is_read:r.z.boolean().default(!1),created_at:r.z.string()});let SupabaseError=class SupabaseError extends Error{constructor(e,t=400,a){super(e),this.name="SupabaseError",this.status=t,this.code=a}};let n="https://yltnvmypasnfdgtnyhwg.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlsdG52bXlwYXNuZmRndG55aHdnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQzNDcxNTMsImV4cCI6MjA1OTkyMzE1M30.ajCPb95af8_It1m_D4yGJhErKuLEtqqfqk8Yq2n4MCw";n&&l||console.error("Missing Supabase environment variables");let o=null;function getBrowserClient(){return o||(o=function(){if(!n||!l)throw new SupabaseError("Missing Supabase environment variables for client",500);return(0,s.eI)(n,l,{auth:{persistSession:!0,autoRefreshToken:!0}})}())}let getProfile=async e=>{let t=getBrowserClient();try{let{data:a,error:r}=await t.from("profiles").select("*").eq("id",e).single();if(r){if("PGRST116"===r.code)return null;throw new SupabaseError("Error fetching profile: ".concat(r.message),r.code?parseInt(r.code):500,r.code)}return i.parse(a)}catch(e){if(console.error("Error in getProfile:",e),e instanceof SupabaseError)throw e;if(e instanceof r.z.ZodError)throw new SupabaseError("Profile data validation failed: ".concat(e.errors.map(e=>e.message).join(", ")),400);throw new SupabaseError(e.message||"Failed to get profile",(null==e?void 0:e.status)||500)}},updateProfile=async(e,t)=>{let a=getBrowserClient(),s=i.partial().omit({id:!0,created_at:!0,updated_at:!0,joining_date:!0}).parse(t),n={...s,updated_at:new Date().toISOString()};try{let{data:t,error:r}=await a.from("profiles").update(n).eq("id",e).select().single();if(r)throw new SupabaseError("Error updating profile: ".concat(r.message),r.code?parseInt(r.code):500,r.code);if(!t)throw new SupabaseError("No data returned after updating profile",500);return i.parse(t)}catch(e){if(console.error("Error in updateProfile:",e),e instanceof SupabaseError)throw e;if(e instanceof r.z.ZodError)throw new SupabaseError("Updated profile data validation failed: ".concat(e.errors.map(e=>e.message).join(", ")),400);throw new SupabaseError(e.message||"Failed to update profile",(null==e?void 0:e.status)||500)}},uploadAvatar=async(e,t)=>{if(!t)return null;let a=t.name.split(".").pop(),r="".concat(e,"-").concat(Date.now(),".").concat(a),s=getBrowserClient();try{let{data:e,error:a}=await s.storage.from("avatars").upload(r,t,{cacheControl:"3600",upsert:!1});if(a)throw new SupabaseError("Avatar upload failed: ".concat(a.message),(null==a?void 0:a.statusCode)||500);if(!e||!e.path)throw new SupabaseError("Avatar upload failed to return a path.",500);let{data:i}=s.storage.from("avatars").getPublicUrl(e.path);return{path:e.path,url:i.publicUrl}}catch(e){if(console.error("Error uploading avatar in API wrapper:",e),e instanceof SupabaseError)throw e;throw new SupabaseError(e.message||"Failed to upload avatar",(null==e?void 0:e.status)||500)}}},4962:function(e,t,a){"use strict";a.d(t,{tN:function(){return s}});var r=a(3265);let s=(0,r.Ue)(e=>({user:null,profile:null,isLoading:!0,setUser:t=>e({user:t}),setProfile:t=>e({profile:t}),setLoading:t=>e({isLoading:t}),signOut:()=>e({user:null,profile:null,isLoading:!1}),clearAuth:()=>e({user:null,profile:null,isLoading:!1})}));(0,r.Ue)(e=>({swipedUsers:[],likedUsers:[],matches:[],addSwipedUser:t=>e(e=>({swipedUsers:[...e.swipedUsers,t]})),addLikedUser:t=>e(e=>({likedUsers:[...e.likedUsers,t]})),setMatches:t=>e({matches:t}),addMatch:t=>e(e=>({matches:[...e.matches,t]})),resetSwipeState:()=>e({swipedUsers:[],likedUsers:[]})})),(0,r.Ue)(e=>({currentChatUserId:null,unreadMessages:{},setCurrentChatUserId:t=>e({currentChatUserId:t}),setUnreadCount:(t,a)=>e(e=>({unreadMessages:{...e.unreadMessages,[t]:a}})),incrementUnreadCount:t=>e(e=>({unreadMessages:{...e.unreadMessages,[t]:(e.unreadMessages[t]||0)+1}})),resetUnreadCount:t=>e(e=>({unreadMessages:{...e.unreadMessages,[t]:0}}))})),(0,r.Ue)(e=>({sidebarOpen:!1,darkMode:window.matchMedia("(prefers-color-scheme: dark)").matches,toggleSidebar:()=>e(e=>({sidebarOpen:!e.sidebarOpen})),setSidebarOpen:t=>e({sidebarOpen:t}),toggleDarkMode:()=>e(e=>({darkMode:!e.darkMode})),setDarkMode:t=>e({darkMode:t})})),(0,r.Ue)(e=>({posts:[],isLoading:!1,hasMore:!0,setPosts:t=>e({posts:t}),appendPosts:t=>e(e=>({posts:[...e.posts,...t]})),setLoading:t=>e({isLoading:t}),setHasMore:t=>e({hasMore:t}),resetPosts:()=>e({posts:[],hasMore:!0})}))},4033:function(e,t,a){e.exports=a(94)}},function(e){e.O(0,[358,980,74,588,971,472,744],function(){return e(e.s=5892)}),_N_E=e.O()}]);