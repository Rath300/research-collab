(()=>{var e={};e.id=478,e.ids=[478],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:e=>{"use strict";e.exports=require("http")},1645:e=>{"use strict";e.exports=require("net")},1781:(e,r,t)=>{Promise.resolve().then(t.bind(t,8869))},1820:e=>{"use strict";e.exports=require("os")},1997:e=>{"use strict";e.exports=require("punycode")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4140:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>i.a,__next_app__:()=>p,pages:()=>d,routeModule:()=>u,tree:()=>c});var s=t(5239),a=t(8088),n=t(8170),i=t.n(n),l=t(893),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(r,o);let c={children:["",{children:["chats",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,8869)),"/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/chats/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,6055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,8014)),"/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,4206)),"/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,6055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/chats/page.tsx"],p={require:t,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/chats/page",pathname:"/chats",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4631:e=>{"use strict";e.exports=require("tls")},4735:e=>{"use strict";e.exports=require("events")},5511:e=>{"use strict";e.exports=require("crypto")},5591:e=>{"use strict";e.exports=require("https")},5734:(e,r,t)=>{"use strict";t.d(r,{KD:()=>l,f3:()=>o});var s=t(5745),a=function(){var e=function(r,t){return(e=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])})(r,t)};return function(r,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}(),n=function(e,r){var t,s,a,n={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=l(0),i.throw=l(1),i.return=l(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(o){var c=[l,o];if(t)throw TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(n=0)),n;)try{if(t=1,s&&(a=2&c[0]?s.return:c[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,c[1])).done)return a;switch(s=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,s=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(!(a=(a=n.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){n=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){n.label=c[1];break}if(6===c[0]&&n.label<a[1]){n.label=a[1],a=c;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(c);break}a[2]&&n.ops.pop(),n.trys.pop();continue}c=r.call(e,n)}catch(e){c=[6,e],s=0}finally{t=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},i=function(e){function r(r,t,s){void 0===t&&(t=400);var a=e.call(this,r)||this;return a.name="SupabaseError",a.status=t,a.code=s,a}return a(r,e),r}(Error),l=function(){return(0,s.createClientComponentClient)()},o=function(e){var r,t,s,a;return r=void 0,t=void 0,s=void 0,a=function(){var r;return n(this,function(t){switch(t.label){case 0:return[4,l().auth.updateUser({password:e})];case 1:if(r=t.sent().error)throw new i(r.message,400,r.code);return[2]}})},new(s||(s=Promise))(function(e,n){function i(e){try{o(a.next(e))}catch(e){n(e)}}function l(e){try{o(a.throw(e))}catch(e){n(e)}}function o(r){var t;r.done?e(r.value):((t=r.value)instanceof s?t:new s(function(e){e(t)})).then(i,l)}o((a=a.apply(r,t||[])).next())})}},7910:e=>{"use strict";e.exports=require("stream")},8229:(e,r,t)=>{Promise.resolve().then(t.bind(t,8680))},8444:(e,r,t)=>{"use strict";t.d(r,{p:()=>i});var s=t(687),a=t(3210),n=t(2348);let i=(0,a.forwardRef)(({label:e,helperText:r,error:t,leftIcon:a,rightIcon:i,isFullWidth:l=!1,size:o="md",className:c,containerClassName:d,labelClassName:p,inputClassName:u,helperTextClassName:x,errorClassName:h,...m},f)=>{let y={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-5 w-5"},g={left:{sm:"pl-7",md:"pl-9",lg:"pl-10"},right:{sm:"pr-7",md:"pr-9",lg:"pr-10"}},b="px-3";a&&(b=g.left[o]),i&&(b=g.right[o]),a&&i&&(b=`${g.left[o]} ${g.right[o]}`);let v=l?"w-full":"",j=t?"border-red-500 focus:ring-red-500":"border-gray-700 dark:border-gray-800";return(0,s.jsxs)("div",{className:(0,n.QP)("flex flex-col",v,d),children:[e&&(0,s.jsx)("label",{htmlFor:m.id,className:(0,n.QP)("block text-sm font-medium text-gray-200 dark:text-gray-300 mb-1",p),children:e}),(0,s.jsxs)("div",{className:"relative",children:[a&&(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-400 dark:text-gray-500",children:(0,s.jsx)("span",{className:y[o],children:a})}),(0,s.jsx)("input",{ref:f,className:(0,n.QP)("bg-gray-900 border text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-950 dark:border-gray-800 dark:text-gray-100 dark:placeholder-gray-600",{sm:"py-1 text-xs rounded",md:"py-2 text-sm rounded-md",lg:"py-2.5 text-base rounded-md"}[o],b,j,v,u,c),...m}),i&&(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400 dark:text-gray-500",children:(0,s.jsx)("span",{className:y[o],children:i})})]}),t&&(0,s.jsx)("p",{className:(0,n.QP)("mt-1 text-xs text-red-400 dark:text-red-400",h),children:t}),r&&!t&&(0,s.jsx)("p",{className:(0,n.QP)("mt-1 text-xs text-gray-400 dark:text-gray-500",x),children:r})]})});i.displayName="Input"},8680:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>h});var s=t(687),a=t(3210),n=t(6189),i=t(2294),l=t(8444),o=t(5814),c=t(6749);function d({message:e}){let{content:r,created_at:t,is_self:a,is_read:n=!1}=e,i=t?(0,o.A)(new Date(t),{addSuffix:!0}):"",l=t?new Date(t).toLocaleString():"";return(0,s.jsx)("div",{className:`flex mb-4 ${a?"justify-end":"justify-start"}`,children:(0,s.jsxs)("div",{className:`relative max-w-[80%] px-4 py-2 rounded-lg ${a?"bg-primary-600 text-white rounded-tr-none":"bg-gray-100 text-gray-800 rounded-tl-none dark:bg-gray-800 dark:text-gray-200"}`,children:[(0,s.jsx)("p",{className:"whitespace-pre-wrap break-words",children:r}),(0,s.jsxs)("div",{className:"flex items-center mt-1 space-x-1",children:[(0,s.jsx)("span",{className:`text-xs ${a?"text-primary-200":"text-gray-500 dark:text-gray-400"}`,title:l,children:i}),a&&(0,s.jsx)("span",{className:"text-primary-200",children:n?(0,s.jsx)(c.A3x,{size:12,title:"Read"}):(0,s.jsx)(c.Ohp,{size:12,title:"Sent"})})]}),(0,s.jsx)("div",{className:`absolute top-0 w-4 h-4 ${a?"right-0 -mr-2 bg-primary-600":"left-0 -ml-2 bg-gray-100 dark:bg-gray-800"}`,style:{clipPath:a?"polygon(0 0, 100% 0, 100% 100%)":"polygon(0 0, 100% 0, 0 100%)"}})]})})}var p=t(8391),u=t(5734);function x(){let e=(0,n.useRouter)(),r=(0,n.useSearchParams)();r?.get("id");let{user:t}=(0,p.nc)(),{currentChatUserId:o,unreadMessages:x,setCurrentChatUserId:h,setUnreadCount:m}=(0,p.Lo)(),[f,y]=(0,a.useState)([]),[g,b]=(0,a.useState)([]),[v,j]=(0,a.useState)(""),[N,w]=(0,a.useState)(!0),[k,_]=(0,a.useState)(!1),[P,S]=(0,a.useState)(""),[q,C]=(0,a.useState)(null),$=(0,a.useRef)(null),[A,z]=(0,a.useState)(!1),E=()=>{setTimeout(()=>{$.current?.scrollIntoView({behavior:"smooth"})},100)},I=async e=>{if(e&&e.preventDefault(),v.trim()&&t&&o&&q)try{_(!0);let e={content:v.trim(),sender_id:t.id,receiver_id:o,match_id:q.id,is_read:!1},r=(0,u.KD)(),{data:s,error:a}=await r.from("messages").insert(e).select().single();if(a)throw a;b([...g,{...s,is_self:!0,read:!1}]),j(""),E()}catch(e){console.error("Error sending message:",e)}finally{_(!1)}},M=r=>{let s=r.user_id_1===t?.id?r.user_id_2:r.user_id_1;h(s),C(r),z(!0),e.push(`/chats?id=${s}`)},G=e=>`${e.profiles.first_name} ${e.profiles.last_name}`;return t?(0,s.jsx)("div",{className:"container mx-auto max-w-6xl px-4 py-8",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row h-[calc(100vh-12rem)] bg-white rounded-lg shadow-md overflow-hidden dark:bg-slate-800",children:[(0,s.jsxs)("div",{className:`w-full md:w-1/3 border-r border-gray-200 dark:border-gray-700 ${A?"hidden md:block":"block"}`,children:[(0,s.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(l.p,{placeholder:"Search conversations...",className:"pr-10"}),(0,s.jsx)(c.CKj,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:18})]})}),(0,s.jsx)("div",{className:"overflow-y-auto h-[calc(100%-4rem)]",children:f.length>0?f.map(e=>{let r=e.user_id_1===t.id?e.user_id_2:e.user_id_1,a=o===r,n=x[r]||0;return(0,s.jsxs)("div",{className:`p-4 border-b border-gray-100 dark:border-gray-700 flex items-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 ${a?"bg-primary-50 dark:bg-primary-900/20":""}`,onClick:()=>M(e),children:[(0,s.jsx)("div",{className:"h-12 w-12 rounded-full bg-primary-100 flex items-center justify-center overflow-hidden",children:e.profiles.avatar_url?(0,s.jsx)("img",{src:e.profiles.avatar_url,alt:G(e),className:"h-full w-full object-cover"}):(0,s.jsx)(c.JXP,{className:"text-primary-600",size:24})}),(0,s.jsxs)("div",{className:"ml-3 flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("p",{className:`text-sm font-medium truncate ${n>0?"text-gray-900 dark:text-white":"text-gray-800 dark:text-gray-200"}`,children:G(e)}),n>0&&(0,s.jsx)("span",{className:"ml-1 bg-primary-600 text-white text-xs font-bold px-2 py-0.5 rounded-full",children:n})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 truncate dark:text-gray-400",children:e.profiles.institution||"Researcher"})]})]},e.id)}):N?(0,s.jsx)("div",{className:"flex justify-center py-8",children:(0,s.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-t-2 border-primary-600"})}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No conversations yet"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Match with researchers to start chatting"}),(0,s.jsx)(i.$,{className:"mt-4",onClick:()=>e.push("/collaborators"),children:"Find Collaborators"})]})})]}),(0,s.jsx)("div",{className:`w-full md:w-2/3 flex flex-col ${A?"block":"hidden md:block"}`,children:o&&q?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center",children:[(0,s.jsx)(i.$,{variant:"ghost",className:"md:hidden mr-2 p-2",onClick:()=>z(!1),children:(0,s.jsx)(c.irw,{size:20})}),(0,s.jsx)("div",{className:"h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center overflow-hidden",children:q.profiles.avatar_url?(0,s.jsx)("img",{src:q.profiles.avatar_url,alt:G(q),className:"h-full w-full object-cover"}):(0,s.jsx)(c.JXP,{className:"text-primary-600",size:20})}),(0,s.jsxs)("div",{className:"ml-3 flex-1",children:[(0,s.jsx)("p",{className:"font-medium",children:G(q)}),(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:q.profiles.institution||"Researcher"})]}),(0,s.jsx)(i.$,{variant:"ghost",className:"p-2",children:(0,s.jsx)(c.ZZB,{size:20})})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-900",children:g.length>0?(0,s.jsxs)("div",{children:[g.map(e=>(0,s.jsx)(d,{message:e},e.id)),(0,s.jsx)("div",{ref:$})]}):N?(0,s.jsx)("div",{className:"flex justify-center py-8",children:(0,s.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-b-2 border-t-2 border-primary-600"})}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No messages yet"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Say hello to start the conversation"})]})}),(0,s.jsx)("form",{onSubmit:I,className:"p-4 border-t border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(l.p,{placeholder:"Type a message...",value:v,onChange:e=>j(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),I())},className:"flex-1"}),(0,s.jsx)(i.$,{type:"submit",className:"ml-2",disabled:!v.trim()||k,isLoading:k,children:(0,s.jsx)(c.kGk,{size:18})})]})})]}):(0,s.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center",children:[(0,s.jsx)(c.SG1,{size:48,className:"text-gray-300 dark:text-gray-600 mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-bold",children:"Select a conversation"}),(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Choose a chat from the list to start messaging"})]})})]})}):(e.push("/login"),null)}function h(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)("div",{className:"p-12 text-center",children:"Loading chat interface..."}),children:(0,s.jsx)(x,{})})}},8869:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/chats/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/chats/page.tsx","default")},9021:e=>{"use strict";e.exports=require("fs")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")},9551:e=>{"use strict";e.exports=require("url")}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,165,956,745,510,886],()=>t(4140));module.exports=s})();