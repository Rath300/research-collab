(()=>{var e={};e.id=566,e.ids=[566],e.modules={136:(e,r,t)=>{"use strict";t.d(r,{BT:()=>l,Wu:()=>d,ZB:()=>n,Zp:()=>o,aR:()=>i,wL:()=>c});var s=t(687);t(3210);var a=t(2348);function o({className:e,...r}){return(0,s.jsx)("div",{className:(0,a.QP)("bg-gray-900 border border-gray-800 shadow-sm rounded-md text-gray-100 dark:bg-black dark:border-gray-800",e),...r})}function i({className:e,...r}){return(0,s.jsx)("div",{className:(0,a.QP)("p-6 flex flex-col space-y-1.5",e),...r})}function n({className:e,...r}){return(0,s.jsx)("h3",{className:(0,a.QP)("font-semibold leading-none tracking-tight text-gray-100 dark:text-gray-50",e),...r})}function l({className:e,...r}){return(0,s.jsx)("p",{className:(0,a.QP)("text-sm text-gray-400 dark:text-gray-400",e),...r})}function d({className:e,...r}){return(0,s.jsx)("div",{className:(0,a.QP)("p-6 pt-0",e),...r})}function c({className:e,...r}){return(0,s.jsx)("div",{className:(0,a.QP)("flex items-center p-6 pt-0",e),...r})}},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:e=>{"use strict";e.exports=require("http")},1645:e=>{"use strict";e.exports=require("net")},1820:e=>{"use strict";e.exports=require("os")},1997:e=>{"use strict";e.exports=require("punycode")},2847:(e,r,t)=>{Promise.resolve().then(t.bind(t,5707))},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3527:(e,r,t)=>{Promise.resolve().then(t.bind(t,6693))},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4631:e=>{"use strict";e.exports=require("tls")},4735:e=>{"use strict";e.exports=require("events")},5511:e=>{"use strict";e.exports=require("crypto")},5591:e=>{"use strict";e.exports=require("https")},5707:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>m});var s=t(687),a=t(3210),o=t(6189),i=t(2294),n=t(8444),l=t(136),d=t(6749),c=t(8391);t(7838);var u=t(5734),p=t(6251);function m(){let e=(0,o.useRouter)(),{user:r,profile:t,setProfile:m,setUser:x}=(0,c.nc)(),[g,h]=(0,a.useState)({first_name:t?.first_name||"",last_name:t?.last_name||"",bio:t?.bio||"",institution:t?.institution||"",location:t?.location||"",field_of_study:t?.field_of_study||"",availability:t?.availability||"full-time"}),[f,b]=(0,a.useState)(!1),[y,v]=(0,a.useState)(""),[j,w]=(0,a.useState)(!0),_=e=>{let{name:r,value:t}=e.target;h(e=>({...e,[r]:t}))},k=async e=>{if(e.preventDefault(),!g.first_name||!g.last_name)return void v("First name and last name are required");if(!r)return void v("No authenticated user found");try{b(!0),v("");let e=(0,u.KD)(),{data:t,error:s}=await e.auth.getSession();if(s||!t?.session)throw console.error("Session error or missing before profile update:",s),Error("Your session has expired. Please sign in again.");parseInt(sessionStorage.getItem("redirect_count")||"0")>5&&(console.error("Detected potential redirect loop, clearing flags"),sessionStorage.removeItem("is_redirecting"),sessionStorage.setItem("redirect_count","0"));let a={id:r.id,first_name:g.first_name,last_name:g.last_name,bio:g.bio||null,institution:g.institution||null,location:g.location||null,field_of_study:g.field_of_study||null,availability:g.availability||"full-time",updated_at:new Date().toISOString()};console.log("Attempting upsert operation with profile data:",a);let{data:o,error:i}=await e.from("profiles").upsert(a,{onConflict:"id"}).select();if(i){console.error("Profile upsert error:",i);try{console.log("Attempting direct insert as fallback");let{data:r,error:t}=await e.from("profiles").insert(a).select();if(t)throw t;if(r&&r.length>0)console.log("Direct insert successful:",r),m(r[0]);else throw Error("Failed to save profile: No data returned")}catch(e){throw console.error("Direct insert failed:",e),Error(`Failed to save profile: ${i.message}`)}}else{console.log("Profile upsert successful:",o);let t=Array.isArray(o)&&o.length>0?o[0]:null;if(!t){console.log("No result from upsert, checking if profile exists...");let{data:s,error:a}=await e.from("profiles").select("*").eq("id",r.id).single();a?console.error("Profile check error:",a):s&&(console.log("Found existing profile:",s),t=s)}if(t)m(t);else{let e={id:r.id,...a};console.log("Using fallback profile:",e),m(e)}}console.log("Profile saved successfully, preparing to redirect to dashboard"),sessionStorage.removeItem("is_redirecting"),sessionStorage.setItem("redirect_count","0"),localStorage.setItem("onboarding_completed","true"),localStorage.setItem("profile_saved","true");let{data:n,error:l}=await e.auth.getSession();if(l)throw console.error("Error verifying final session:",l),Error("Session verification failed after profile update");if(console.log("Final session check:",n?.session?"Valid":"Invalid"),!n?.session){console.warn("No session found after profile update, attempting to refresh");let{data:r,error:t}=await e.auth.refreshSession();if(t||!r.session)throw console.error("Session refresh failed:",t),Error("Could not refresh your session. Please sign in again.");console.log("Session refreshed successfully")}try{let{data:t,error:s}=await e.auth.getUser();s?console.error("Final auth verification error:",s):console.log("Auth verification successful, user ID:",t.user?.id),localStorage.setItem("auth_dashboard_transition","true"),localStorage.setItem("last_auth_check",new Date().toISOString());try{localStorage.setItem("auth_user_backup",JSON.stringify(t?.user||r))}catch(e){console.error("Could not store user backup:",e)}}catch(e){console.error("Session preparation error:",e)}await new Promise(e=>setTimeout(e,800)),console.log("Redirecting to dashboard...");let d=new URL("/dashboard",window.location.origin);d.searchParams.set("_t",Date.now().toString()),window.location.href=d.toString()}catch(e){console.error("Onboarding error:",e),v(e.message||"Failed to update profile")}finally{b(!1)}},N=async()=>{try{b(!0);let e=(0,u.KD)();await e.auth.signOut(),localStorage.clear(),sessionStorage.clear(),x(null),m(null),v(""),window.location.href="/login?fresh=true"}catch(e){console.error("Reset error:",e),v("Failed to reset authentication state")}finally{b(!1)}};return j?(0,s.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900",children:[(0,s.jsx)(p.y,{size:"large"}),(0,s.jsx)("h2",{className:"mt-4 text-xl font-medium",children:"Verifying your account..."}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Please wait while we load your profile."})]}):r?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8 dark:bg-gray-900",children:(0,s.jsxs)("div",{className:"max-w-md w-full",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Complete Your Profile"}),(0,s.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Tell us a bit about yourself to get started"})]}),(0,s.jsxs)(l.Zp,{children:[(0,s.jsxs)(l.aR,{children:[(0,s.jsx)(l.ZB,{children:"Profile Information"}),(0,s.jsx)(l.BT,{children:"Help others find and connect with you"})]}),(0,s.jsxs)("form",{onSubmit:k,children:[(0,s.jsxs)(l.Wu,{className:"space-y-4",children:[y&&(0,s.jsxs)("div",{className:"bg-red-50 text-red-600 p-3 rounded-md flex items-center space-x-2 text-sm dark:bg-red-900/20 dark:text-red-400",children:[(0,s.jsx)(d.y3G,{className:"h-5 w-5 flex-shrink-0"}),(0,s.jsx)("span",{children:y})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(n.p,{label:"First Name",name:"first_name",value:g.first_name,onChange:_,leftIcon:(0,s.jsx)(d.JXP,{}),required:!0}),(0,s.jsx)(n.p,{label:"Last Name",name:"last_name",value:g.last_name,onChange:_,leftIcon:(0,s.jsx)(d.JXP,{}),required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bio"}),(0,s.jsx)("textarea",{name:"bio",value:g.bio||"",onChange:_,placeholder:"Tell others about your research interests and expertise...",className:"flex w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent min-h-[100px] disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-700 dark:bg-gray-900"})]}),(0,s.jsx)(n.p,{label:"Institution",name:"institution",value:g.institution||"",onChange:_,leftIcon:(0,s.jsx)(d.VeH,{}),placeholder:"e.g., Stanford University"}),(0,s.jsx)(n.p,{label:"Location",name:"location",value:g.location||"",onChange:_,leftIcon:(0,s.jsx)(d.HzC,{}),placeholder:"e.g., San Francisco, CA"}),(0,s.jsx)(n.p,{label:"Field of Study",name:"field_of_study",value:g.field_of_study||"",onChange:_,placeholder:"e.g., Computer Science"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Availability"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(d.Ohp,{className:"mr-2 text-gray-500"}),(0,s.jsxs)("select",{name:"availability",value:g.availability||"full-time",onChange:_,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-800 dark:border-gray-700 dark:text-white",children:[(0,s.jsx)("option",{value:"full-time",children:"Full Time"}),(0,s.jsx)("option",{value:"part-time",children:"Part Time"}),(0,s.jsx)("option",{value:"weekends",children:"Weekends Only"}),(0,s.jsx)("option",{value:"not-available",children:"Not Available"})]})]})]})]}),(0,s.jsxs)(l.wL,{className:"flex justify-between",children:[(0,s.jsxs)(i.$,{type:"button",variant:"outline",onClick:N,children:[(0,s.jsx)(d.jTZ,{className:"mr-2",size:16}),"Reset Auth"]}),(0,s.jsxs)(i.$,{type:"submit",isLoading:f,children:[(0,s.jsx)(d.Bc_,{className:"mr-2",size:16}),"Save Profile"]})]})]})]})]})}):(0,s.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,s.jsxs)("div",{className:"bg-red-50 text-red-600 p-4 rounded-md mb-4 max-w-md text-center",children:[(0,s.jsx)(d.y3G,{className:"h-8 w-8 mx-auto mb-2"}),(0,s.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Authentication Required"}),(0,s.jsx)("p",{className:"mb-4",children:"You need to be signed in to access this page."}),(0,s.jsx)(i.$,{onClick:()=>e.push("/login"),className:"mr-2",children:"Go to Login"}),(0,s.jsxs)(i.$,{variant:"outline",onClick:N,children:[(0,s.jsx)(d.jTZ,{className:"mr-2 h-4 w-4"}),"Reset Auth"]})]})})}},6693:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/onboarding/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/onboarding/page.tsx","default")},7574:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var s=t(5239),a=t(8088),o=t(8170),i=t.n(o),n=t(893),l={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);t.d(r,l);let d={children:["",{children:["onboarding",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,6693)),"/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/onboarding/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,6055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,8014)),"/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,4206)),"/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,6055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Users/shreyansh/ItsMightHappenApp/research-collab-standalone/app/onboarding/page.tsx"],u={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/onboarding/page",pathname:"/onboarding",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},7910:e=>{"use strict";e.exports=require("stream")},8444:(e,r,t)=>{"use strict";t.d(r,{p:()=>i});var s=t(687),a=t(3210),o=t(2348);let i=(0,a.forwardRef)(({label:e,helperText:r,error:t,leftIcon:a,rightIcon:i,isFullWidth:n=!1,size:l="md",className:d,containerClassName:c,labelClassName:u,inputClassName:p,helperTextClassName:m,errorClassName:x,...g},h)=>{let f={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-5 w-5"},b={left:{sm:"pl-7",md:"pl-9",lg:"pl-10"},right:{sm:"pr-7",md:"pr-9",lg:"pr-10"}},y="px-3";a&&(y=b.left[l]),i&&(y=b.right[l]),a&&i&&(y=`${b.left[l]} ${b.right[l]}`);let v=n?"w-full":"",j=t?"border-red-500 focus:ring-red-500":"border-gray-700 dark:border-gray-800";return(0,s.jsxs)("div",{className:(0,o.QP)("flex flex-col",v,c),children:[e&&(0,s.jsx)("label",{htmlFor:g.id,className:(0,o.QP)("block text-sm font-medium text-gray-200 dark:text-gray-300 mb-1",u),children:e}),(0,s.jsxs)("div",{className:"relative",children:[a&&(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-400 dark:text-gray-500",children:(0,s.jsx)("span",{className:f[l],children:a})}),(0,s.jsx)("input",{ref:h,className:(0,o.QP)("bg-gray-900 border text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent disabled:cursor-not-allowed disabled:opacity-50 dark:bg-gray-950 dark:border-gray-800 dark:text-gray-100 dark:placeholder-gray-600",{sm:"py-1 text-xs rounded",md:"py-2 text-sm rounded-md",lg:"py-2.5 text-base rounded-md"}[l],y,j,v,p,d),...g}),i&&(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400 dark:text-gray-500",children:(0,s.jsx)("span",{className:f[l],children:i})})]}),t&&(0,s.jsx)("p",{className:(0,o.QP)("mt-1 text-xs text-red-400 dark:text-red-400",x),children:t}),r&&!t&&(0,s.jsx)("p",{className:(0,o.QP)("mt-1 text-xs text-gray-400 dark:text-gray-500",m),children:r})]})});i.displayName="Input"},9021:e=>{"use strict";e.exports=require("fs")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")},9551:e=>{"use strict";e.exports=require("url")}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,165,956,745,886,561],()=>t(7574));module.exports=s})();